jobs:
  include:
    - stage: build application
      script:
        - ./mvnw install
    - stage: static code analysis
      addons:
        sonarcloud:
          organization: badegr
          token: $SONAR_TOKEN
      script:
        - mvn org.jacoco:jacoco-maven-plugin:prepare-agent javadoc:javadoc verify sonar:sonar 
        - cd ..
        - "git clone https://github.com/badegr/docs.git"
        - rm -rf docs/generated/jacoco-ut docs/generated/jacoco-it docs/generated/apidocs
        - cp -r application/target/site/jacoco-ut docs/generated/
        - cp -r application/target/site/jacoco-it docs/generated/
        - cp -r application/target/site/apidocs docs/generated/
        - cd docs/generated
        - git add --all
        - git commit -am "update documentation"
        - git push "https://${TRAVIS_GITHUB_TOKEN}@github.com/badegr/docs.git" master
